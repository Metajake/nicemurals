
{% extends 'blog/base.html' %}
{% url 'blog-home' as home %}
{% block extrahead %}
<title>First Studio | Blog</title>{% endblock %}
{% block masthead-headline %}<a href="{{home}}">
  <h1 class="title is-2">First Studio.Co</h1></a><a href="{{home}}">
  <h2 class="subtitle is-6">The Interactive Work of Jacob North</h2></a>{% endblock %}  
{% block main-content %}
<div class="columns">
  <div class="column is-four-fifths">
    {% for entry in entries reversed %}
    {% if forloop.first %}<div class="columns">{% endif %}
    <div class="column">
      <div class="card">{% for work in entry.images.all %}{% if forloop.first %}
        <div class="card-image">
          <div class="figure image is-4by3"><img src="{{ work.image.url }}"/></div>
        </div>{% endif %}{% endfor %}
        <div class="card-content">
          <div class="content"><a href="/entry/{{entry.slug}}">
              <h3 class="title is-4">{{entry.title}} </h3>
              <h4 class="subtitle is-6">{{entry.richbody | safe | truncatewords:7}}</h4></a></div>
        </div>
        <footer class="card-footer">
          <div class="card-footer-item justify-left">
            <p>{{entry.created}}</p>
          </div>
        </footer>
      </div>
    </div>{% if forloop.counter|divisibleby:"5" %}</div><div class="columns">{% endif %}
    {% if forloop.last %}{% for i in emptycards|rjust:emptycards %}<div class="column"></div>{% endfor %}</div>{% endif %}
    {% endfor %}
  </div>
  <div class="column">
    <div class="section">
      <div class="content">
        <h3>Categories</h3>
        <ul>{% for tag in tags %}
          <li><a href="/tags/{{tag}}">{{tag}}</a></li>{% endfor %}
        </ul>
      </div>
    </div>
    <div class="section">
      <div class="columns">
        <div class="column is-centered is-11">{% for entity in game.entities %}
          <div class="card">
            <div class="card-content">
              <div class="content">
                <div id="entity-{{entity.pk}}">
                  <p>{{entity.name}}</p><small>Exp: <span class="exp">{{entity.experience}}</span></small>
                </div>
              </div>
            </div>
          </div>{% endfor %}
        </div>
      </div>
    </div>{% url 'gain-experience' as gainexperience %}
    <script>
      var enableExpHandler;
      
      document.addEventListener("DOMContentLoaded", function(){
        $(document).mousemove(function(e){
          if (enableExpHandler) {
            gainExp(1);
            enableExpHandler = false;
          }
        });
        $(document).scroll(function(e){
          if (enableExpHandler) {
            gainExp(1);
            enableExpHandler = false;
          }
        });
      })
      
      timer = window.setInterval(function(){
        enableExpHandler = true;
      }, 500);
      
      function gainExp(difference){
        $.ajax({
          type: "POST",
          url: "{{gainexperience}}",
          data: {
            entityId :1,
            experienceAmount: difference,
            csrfmiddlewaretoken: '{{ csrf_token }}',
          },
          success: function(data){
            firstEntity = JSON.parse(data)[0]
            $( '#entity-' + firstEntity['pk'].toString() ).html()
            $( '#entity-' + firstEntity['pk'].toString() + ' .exp').html(firstEntity['fields']['experience'])
            document.removeEventListener('mousemove', function(){})
          }
        })
      }
    </script>
  </div>
</div>{% endblock %}